---
title: "Sentiment analysis twitter legislative election"
author: "Fahrozi" 
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{exploring-the-census data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  comment = "#>"
)
```

## Exploring the Indonesia census data 2010

This vignette documents used how to explore and see the sentiment analysis about the legislative election in Indonesia, data collected from the twitter tweets and used official twitter APIs.


```{r sentimentanalysis_aboutelection in Indonesia, eval = FALSE}

library(twitteR)
library(RSentiment)
# library(sentiment)
library(tm)
library(NLP)
library(Rstem)
library(plyr)
library(ggplot2)
library(wordcloud)
library(RColorBrewer)
```

#use twitter APIs to get the data
```{r call_thetwitter_APIs}
api_key <-""
api_secret<-""
access_token<-""
access_token_secret<-""

```

#remove the hastags and other twitter handles
```{r call_dataset_and__removehastags}
setup_twitter_oauth(api_key, api_secret,access_token, access_token_secret)

some_tweets = searchTwitter("pemilu legislatif", n=10000, lang="id")
some_txt = sapply(some_tweets, function(x) x$getText())
some_txt = gsub("(RT|via)((?:\\b\\W*@\\w+)+)", "", some_txt)
some_txt = gsub("@\\w+", "", some_txt)
some_txt = gsub("[[:punct:]]", "", some_txt)
some_txt = gsub("[[:digit:]]", "", some_txt)
some_txt = gsub("http\\w+", "", some_txt)
some_txt = gsub("[ \t]{2,}", "", some_txt)
some_txt = gsub("^\\s+|\\s+$", "", some_txt)
try.error = function(x)
{
  y = NA
try_error = tryCatch(tolower(x), error=function(e) e)
if (!inherits(try_error, "error"))
y = tolower(x)
return(y) }
some_txt = sapply(some_txt, try.error)
some_txt = some_txt[!is.na(some_txt)]
names(some_txt) = NULL
class_emo = classify_emotion(some_txt, algorithm="bayes", prior=1.0)
emotion = class_emo[,7]
emotion[is.na(emotion)] = "unknown"
class_pol = classify_polarity(emotion, algorithm="bayes")
polarity = class_pol[,4]
```
#contains tweets about the keyword"pemilu legislatif"
```{r collect_thetweetts}
sentiment_df = data.frame(text=some_txt, emotion=emotion,
polarity=polarity, stringsAsFactors=FALSE)
sentiment_df = within(sentiment_df,
emotion <- factor(emotion, levels=names(sort(table(emotion), decreasing=TRUE))))
```

#plot about emotion from the tweets
```{r plot_thetweets}
ggplot(sentiment_df, aes(x=emotion)) +
geom_bar(aes(y=..count.., fill=emotion)) +
scale_fill_brewer(palette="Dark2") +
labs(x="emotion categories", y="number of tweets") +
labs( "Sentiment Analysis of Tweets about pemilu legislatif\n(classification by emotion)",
plot.title = element_text(size=12))
```

#polarities from the tweets
```{r sentimentanalysis_polarities}
ggplot(sentiment_df, aes(x=polarity)) +
geom_bar(aes(y=..count.., fill=polarity)) +
scale_fill_brewer(palette="RdGy") +
labs(x="polarity categories", y="number of tweets") +
labs( "Sentiment Analysis of Tweets about pemilu legislatif\n(classification by emotion)",
plot.title = element_text(size=12))
```

#wordscloud
```{r wordcloud}
emos = levels(factor(sent_df$emotion))
nemo = length(emos)
emo.docs = rep("", nemo)
for (i in 1:nemo)
{
tmp = some_txt[emotion == emos[i]]
emo.docs[i] = paste(tmp, collapse=" ")
}
emo.docs = removeWords(emo.docs, stopwords("english"))
corpus = Corpus(VectorSource(emo.docs))
tdm = TermDocumentMatrix(corpus)
tdm = as.matrix(tdm)
colnames(tdm) = emos
comparison.cloud(tdm, colors = brewer.pal(nemo, "Dark2"),
scale = c(3,.5), random.order = FALSE, title.size = 1.5)
```



